<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ETH Autonomous AI Bot</title>
<style>
    body{background:#020617;color:white;font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;margin:0;padding:20px}
    .container{max-width:1000px;margin:auto}
    .dashboard{display:grid;grid-template-columns:repeat(4, 1fr);gap:15px;margin-bottom:20px}
    .card{background:#0f172a;padding:15px;border-radius:12px;border:1px solid #1e293b;text-align:center}
    .card h3{margin:0;font-size:0.8em;color:#94a3b8;text-transform:uppercase}
    .card p{margin:10px 0 0;font-size:1.4em;font-weight:bold}
    
    canvas{background:#020617;border:1px solid #334155;border-radius:8px;width:100%;height:300px;margin-bottom:20px}
    
    .history-container{background:#0f172a;border-radius:12px;border:1px solid #1e293b;padding:15px;text-align:left}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th{color:#94a3b8;font-size:0.85em;text-align:left;padding:10px;border-bottom:1px solid #1e293b}
    td{padding:10px;font-size:0.9em;border-bottom:1px solid #020617}
    
    .green{color:#22c55e} .red{color:#ef4444}
    .btn-start{background:#22c55e;color:white;border:none;padding:10px 25px;border-radius:8px;cursor:pointer;font-weight:bold}
    .btn-stop{background:#ef4444;color:white;border:none;padding:10px 25px;border-radius:8px;cursor:pointer;font-weight:bold}
    .controls{margin-bottom:20px}
</style>
</head>
<body>

<div class="container">
    <h2>ETH/USDT Autonomous Bot (15m)</h2>
    
    <div class="controls">
        <button id="startBtn" class="btn-start" onclick="start()">START BOT</button>
        <button id="stopBtn" class="btn-stop" onclick="stop()" style="display:none">STOP BOT</button>
        <span id="status" style="margin-left:15px;color:#94a3b8">Status: IDLE</span>
    </div>

    <div class="dashboard">
        <div class="card"><h3>Balance</h3><p id="bal-val">$10,000.00</p></div>
        <div class="card"><h3>Total P/L</h3><p id="pl-val">$0.00</p></div>
        <div class="card"><h3>Win Rate</h3><p id="wr-val">0%</p></div>
        <div class="card"><h3>Open P/L</h3><p id="open-pl" class="green">$0.00</p></div>
    </div>

    <canvas id="chartCanvas"></canvas>

    <div class="history-container">
        <h3>Trade History</h3>
        <table id="historyTable">
            <thead>
                <tr>
                    <th>Type</th>
                    <th>Entry</th>
                    <th>Exit</th>
                    <th>Result</th>
                    <th>Time</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<script>
let run = false, balance = 10000, initialBalance = 10000, pos = null;
let wins = 0, loss = 0, tradeHistory = [];

const symbol = "ETHUSDT";
const interval = "15m";

// Indicators
const rsi = (c, p=14) => {
    let g=0, l=0;
    for(let i=c.length-p; i<c.length; i++){
        let d = c[i]-c[i-1]; d>0 ? g+=d : l-=d;
    }
    return 100 - (100/(1+(g/l)));
};

const atr = (h, l, c, p=14) => {
    let sum = 0;
    for(let i=c.length-p; i<c.length; i++) sum += Math.max(h[i]-l[i], Math.abs(h[i]-c[i-1]), Math.abs(l[i]-c[i-1]));
    return sum/p;
};

async function loop() {
    if(!run) return;

    try {
        const resp = await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=100`);
        const data = await resp.json();
        
        let closes = data.map(x=>+x[4]), highs = data.map(x=>+x[2]), lows = data.map(x=>+x[3]);
        let price = closes.at(-1), currentRsi = rsi(closes), currentAtr = atr(highs, lows, closes);
        
        draw(closes);

        if(!pos) {
            // Signal Logic
            let ai = (closes.at(-1) - closes.at(-10));
            if(ai > 0 && currentRsi < 40) { // Oversold bounce
                openPosition("BUY", price, currentAtr);
            } else if(ai < 0 && currentRsi > 60) { // Overbought rejection
                openPosition("SELL", price, currentAtr);
            }
            document.getElementById('status').innerHTML = "Status: SCANNING MARKET...";
            document.getElementById('open-pl').innerHTML = "$0.00";
        } else {
            // Managed Execution
            let pnl = (price - pos.entry) * (pos.type=="BUY"?1:-1) * pos.qty;
            document.getElementById('open-pl').innerHTML = (pnl >= 0 ? '+' : '') + "$" + pnl.toFixed(2);
            document.getElementById('open-pl').className = pnl >= 0 ? 'green' : 'red';

            if(price >= pos.tp || price <= pos.sl) {
                closePosition(price, pnl);
            }
            document.getElementById('status').innerHTML = `Status: IN ${pos.type} TRADE`;
        }
    } catch(e) { console.error("Update Error"); }
    
    setTimeout(loop, 4000);
}

function openPosition(type, price, volatility) {
    let risk = balance * 0.02;
    pos = {
        type: type,
        entry: price,
        qty: risk / (volatility * 2),
        sl: type == "BUY" ? price - (volatility * 2) : price + (volatility * 2),
        tp: type == "BUY" ? price + (volatility * 3) : price - (volatility * 3),
        time: new Date().toLocaleTimeString()
    };
}

function closePosition(price, pnl) {
    balance += pnl;
    let trade = { ...pos, exit: price, pnl: pnl, closeTime: new Date().toLocaleTimeString() };
    tradeHistory.unshift(trade);
    pnl > 0 ? wins++ : loss++;
    pos = null;
    updateUI();
}

function updateUI() {
    document.getElementById('bal-val').innerHTML = "$" + balance.toFixed(2);
    document.getElementById('pl-val').innerHTML = (balance - initialBalance >= 0 ? '+' : '') + "$" + (balance - initialBalance).toFixed(2);
    document.getElementById('pl-val').className = (balance - initialBalance >= 0) ? 'green' : 'red';
    document.getElementById('wr-val').innerHTML = (wins+loss > 0) ? ((wins/(wins+loss))*100).toFixed(0) + "%" : "0%";
    
    let html = "";
    tradeHistory.slice(0, 10).forEach(t => {
        html += `<tr>
            <td class="${t.type=='BUY'?'green':'red'}">${t.type}</td>
            <td>${t.entry.toFixed(2)}</td>
            <td>${t.exit.toFixed(2)}</td>
            <td class="${t.pnl>=0?'green':'red'}">${t.pnl >= 0 ? '+' : ''}${t.pnl.toFixed(2)}</td>
            <td>${t.closeTime}</td>
        </tr>`;
    });
    document.querySelector("#historyTable tbody").innerHTML = html;
}

function draw(data) {
    const canvas = document.getElementById('chartCanvas');
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0,0,canvas.width,canvas.height);
    let max=Math.max(...data), min=Math.min(...data), range=max-min;
    ctx.beginPath();
    ctx.strokeStyle = "#3b82f6";
    data.forEach((v,i) => {
        let x = i * (canvas.width/data.length);
        let y = canvas.height - ((v-min)/range) * canvas.height;
        i == 0 ? ctx.moveTo(x,y) : ctx.lineTo(x,y);
    });
    ctx.stroke();
}

function start() { 
    run = true; 
    document.getElementById('startBtn').style.display = 'none';
    document.getElementById('stopBtn').style.display = 'inline-block';
    loop(); 
}
function stop() { 
    run = false; 
    document.getElementById('startBtn').style.display = 'inline-block';
    document.getElementById('stopBtn').style.display = 'none';
    document.getElementById('status').innerHTML = "Status: IDLE";
}
</script>
</body>
</html>
