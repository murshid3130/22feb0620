<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ETH Pro AI Bot - Stable Version</title>
    <style>
        body{background:#020617;color:#e2e8f0;font-family:sans-serif;margin:0;padding:20px}
        .container{max-width:1000px;margin:auto}
        .dashboard{display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:15px;margin:20px 0}
        .card{background:#0f172a;padding:15px;border-radius:12px;border:1px solid #1e293b;text-align:center}
        .card h3{margin:0;font-size:12px;color:#94a3b8;text-transform:uppercase}
        .card p{margin:10px 0 0;font-size:22px;font-weight:bold}
        canvas{background:#020617;border:1px solid #334155;border-radius:8px;width:100%;height:300px}
        .green{color:#22c55e} .red{color:#ef4444}
        .btn{padding:12px 30px;border-radius:8px;cursor:pointer;font-weight:bold;border:none;transition:0.3s}
        #startBtn{background:#22c55e;color:white}
        #stopBtn{background:#ef4444;color:white;display:none}
        table{width:100%;border-collapse:collapse;margin-top:20px;background:#0f172a;border-radius:8px;overflow:hidden}
        th, td{padding:12px;text-align:left;border-bottom:1px solid #1e293b}
        th{background:#1e293b;color:#94a3b8}
    </style>
</head>
<body>

<div class="container">
    <h2>ETH/USDT AI Trading Terminal</h2>
    
    <div class="controls">
        <button id="startBtn" class="btn" onclick="startBot()">START LIVE TRADING</button>
        <button id="stopBtn" class="btn" onclick="stopBot()">STOP BOT</button>
        <span id="status" style="margin-left:15px;color:#94a3b8">Status: Offline</span>
    </div>

    <div class="dashboard">
        <div class="card"><h3>Balance</h3><p id="bal-val">$10,000.00</p></div>
        <div class="card"><h3>Active P/L</h3><p id="open-pl">$0.00</p></div>
        <div class="card"><h3>Win Rate</h3><p id="wr-val">0%</p></div>
        <div class="card"><h3>Total Profit</h3><p id="pl-val">$0.00</p></div>
    </div>

    <canvas id="chartCanvas" width="1000" height="300"></canvas>

    <table>
        <thead><tr><th>Type</th><th>Entry</th><th>Exit</th><th>P/L</th><th>Time</th></tr></thead>
        <tbody id="historyBody"></tbody>
    </table>
</div>

<script>
let isRunning = false;
let balance = 10000, initialBalance = 10000;
let currentPosition = null;
let stats = { wins: 0, losses: 0, history: [] };

// Indicator: RSI
const calculateRSI = (prices, period = 14) => {
    if (prices.length < period + 1) return 50;
    let gains = 0, losses = 0;
    for (let i = prices.length - period; i < prices.length; i++) {
        let diff = prices[i] - prices[i - 1];
        diff > 0 ? gains += diff : losses -= diff;
    }
    return 100 - (100 / (1 + (gains / losses || 1)));
};

async function tradeLoop() {
    if (!isRunning) return;

    try {
        const response = await fetch(`https://api.binance.com/api/v3/klines?symbol=ETHUSDT&interval=15m&limit=100`);
        if (!response.ok) throw new Error("Network issue");
        const data = await response.json();
        
        const closes = data.map(d => parseFloat(d[4]));
        const price = closes[closes.length - 1];
        const rsi = calculateRSI(closes);

        updateChart(closes);
        
        if (!currentPosition) {
            document.getElementById('status').innerText = "Status: Scanning (RSI: " + rsi.toFixed(2) + ")";
            if (rsi < 30) executeTrade("BUY", price);
            else if (rsi > 70) executeTrade("SELL", price);
        } else {
            manageTrade(price);
        }
    } catch (err) {
        console.error("Loop Error:", err);
        document.getElementById('status').innerText = "Status: Connection Retrying...";
    }

    // Hang se bachne ke liye setTimeout ka use (Thread ko break deta hai)
    setTimeout(tradeLoop, 3000); 
}

function executeTrade(type, price) {
    currentPosition = { type, entry: price, qty: (balance * 0.1) / price };
    document.getElementById('status').innerText = `Status: Active ${type} Trade`;
}

function manageTrade(currentPrice) {
    let pnl = (currentPrice - currentPosition.entry) * (currentPosition.type === "BUY" ? 1 : -1) * currentPosition.qty;
    
    // UI Update
    const plEl = document.getElementById('open-pl');
    plEl.innerText = (pnl >= 0 ? "+" : "") + "$" + pnl.toFixed(2);
    plEl.className = pnl >= 0 ? "green" : "red";

    // Auto-Close Logic (TP/SL)
    let movePercent = ((currentPrice - currentPosition.entry) / currentPosition.entry) * 100;
    if (Math.abs(movePercent) > 0.5) { // 0.5% Target/Stop
        closeTrade(currentPrice, pnl);
    }
}

function closeTrade(exitPrice, pnl) {
    balance += pnl;
    pnl > 0 ? stats.wins++ : stats.losses++;
    
    const tradeRow = `<tr>
        <td class="${currentPosition.type=='BUY'?'green':'red'}">${currentPosition.type}</td>
        <td>${currentPosition.entry.toFixed(2)}</td>
        <td>${exitPrice.toFixed(2)}</td>
        <td class="${pnl>=0?'green':'red'}">${pnl.toFixed(2)}</td>
        <td>${new Date().toLocaleTimeString()}</td>
    </tr>`;
    
    document.getElementById('historyBody').insertAdjacentHTML('afterbegin', tradeRow);
    currentPosition = null;
    updateUI();
}

function updateUI() {
    document.getElementById('bal-val').innerText = "$" + balance.toFixed(2);
    document.getElementById('pl-val').innerText = "$" + (balance - initialBalance).toFixed(2);
    const total = stats.wins + stats.losses;
    document.getElementById('wr-val').innerText = total > 0 ? ((stats.wins/total)*100).toFixed(0) + "%" : "0%";
}

function updateChart(data) {
    const canvas = document.getElementById('chartCanvas');
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    const min = Math.min(...data), max = Math.max(...data), range = max - min;
    ctx.beginPath();
    ctx.strokeStyle = "#3b82f6";
    ctx.lineWidth = 2;
    data.forEach((val, i) => {
        const x = (i / data.length) * canvas.width;
        const y = canvas.height - ((val - min) / range) * canvas.height;
        i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
    });
    ctx.stroke();
}

function startBot() {
    if (isRunning) return;
    isRunning = true;
    document.getElementById('startBtn').style.display = 'none';
    document.getElementById('stopBtn').style.display = 'inline-block';
    tradeLoop();
}

function stopBot() {
    isRunning = false;
    document.getElementById('startBtn').style.display = 'inline-block';
    document.getElementById('stopBtn').style.display = 'none';
    document.getElementById('status').innerText = "Status: Offline";
}
</script>
</body>
</html>
